<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Livestream Editor</title>
  <link rel="stylesheet" href="layout.css" />
</head>
<body>
  <div id="toolbar" class="toolbar">
    <span class="label">Room:</span>
    <span id="roomId" style="font-weight:bold; color:#fff;"></span>

    <button id="addText" title="Add Text Box">Add Text</button>
    <div id="text-tools">
      <span class="label">Format:</span>
      <button id="boldBtn"      title="Bold"><b>B</b></button>
      <button id="underlineBtn" title="Underline"><u>U</u></button>
      <button id="bulletBtn"    title="• List">&bull; List</button>
      <button id="numberBtn"    title="1. List">1. List</button>
    </div>

    <button id="castTab" title="Cast Your Tab">Cast Tab</button>
    <button id="addCam"  title="Add Webcam PiP">Add Cam</button>

    <label class="label" for="imgUpload">Image:</label>
    <input type="file" id="imgUpload" accept="image/*" />

    <label class="label" for="vidUpload">Video:</label>
    <input type="file" id="vidUpload" accept="video/*" />

    <button id="micToggle" title="Toggle Mic">Mic On/Off</button>
    <label class="label" for="micVol">Mic Vol:</label>
    <input type="range" id="micVol" min="0" max="2" step="0.01" value="1" />
    <label class="label" for="tabVol">Tab Vol:</label>
    <input type="range" id="tabVol" min="0" max="2" step="0.01" value="1" />
    <label class="label" for="mixVol">Mix Vol:</label>
    <input type="range" id="mixVol" min="0" max="2" step="0.01" value="1" />

    <button id="start" title="Start Livestream">Start Livestream</button>
    <button id="stop"  title="Stop Livestream">Stop Livestream</button>

    <span class="label">Share Link:</span>
    <input type="text" id="shareLink" readonly title="Copy this link to share" />

    <button id="copyURL" title="Copy Viewer Link">Copy URL</button>
    <a id="viewLink" href="#" title="View Stream">View Stream</a>

    <button id="exportLayout" title="Export Layout">Export</button>
    <input type="file" id="importLayout" title="Import Layout" />

    <img
      class="company-logo"
      src="https://avatars.githubusercontent.com/oa/3033067?s=240&u=00ea87da3687ce9135fac4ae4cf569eb7179885d&v=4"
      alt="Logo"
      title="Livestream"
    />
  </div>

  <div id="canvas"></div>

  <!-- libs + Socket.io -->
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
  ;(function() {
    const params = new URLSearchParams(location.search);
    const room   = params.get('room') || '';
    const origin = location.origin;
    const share  = `${origin}/viewer.html?room=${room}`;

    // Display room & share link
    document.getElementById('roomId').innerText     = room;
    document.getElementById('shareLink').value     = share;
    document.getElementById('viewLink').href       = share;

    // Copy share link
    document.getElementById('copyURL').onclick = () => {
      navigator.clipboard.writeText(share);
      alert('Link copied:\n' + share);
    };

    // —— Editor Mode Setup ——  
    const socket = io({ query: { room } });
    const ctx    = new AudioContext();
    let micNode, tabNode;

    // InteractJS helper
    function enableInteract(el) {
      interact(el)
        .draggable({ onstart(){el.classList.add('dragging')},
                     onmove: dragMove,
                     onend(){el.classList.remove('dragging')} })
        .resizable({ edges:{left:1, right:1, top:1, bottom:1}, onmove: resizeMove })
        .gesturable({ onmove: rotateMove });
    }
    function dragMove(e){ /* same as before */ }
    function resizeMove(e){ /* same as before */ }
    function rotateMove(e){ /* same as before */ }

    // Text formatting tools
    /* same as before: execCommand + show/hide text-tools */

    // Add text, media, camera, mic, record/stream, export/import
    /* copy over your existing handlers */
  })();
  </script>
</body>
</html>